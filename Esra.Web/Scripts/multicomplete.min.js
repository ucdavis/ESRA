(function($,f,g){g=f.prototype;$.widget('ui.multicomplete',f,{_search:function(a){g._search.call(this,a.match(/\s*([^,]*)\s*$/)[1])},_trigger:function(a,b,c){var d=g._trigger.apply(this,arguments);if(a=='select'&&d!==false){var e=this.element.val();this.element.val(e.replace(/[^,]+$/,(e.indexOf(',')!=-1?' ':'')+c.item.value+', '));d=false}return(a=='focus'?false:d)},_create:function(){var a=this;this.element.keydown(function(e){a.menu.active&&e.keyCode==$.ui.keyCode.TAB&&e.preventDefault()});g._create.call(this)},_initSource:function(){if($.isArray(this.options.source)){var c=this.options.source,self=this;this.options.source=function(a,b){b(self.filter(c,a))}}g._initSource.call(this);var d=this.source;this.source=function(a,b){a.selected=this.element.val().split(/\s*,\s*/);a.selected.pop();d(a,b)}},filter:function(b,c){return $.grep(f.filter(b,c.term),function(a){return $.inArray(a,c.selected)==-1})}})})(jQuery,jQuery.ui.autocomplete);